# 碳循环饮食计算器 - Vite + React + shadcn/ui PRD（含动态粒子背景 & 玻璃拟态）

## 1. 项目概述

基于凯圣王碳循环饮食理论开发一个网页计算器，帮助健身人群计算个性化的碳循环饮食方案。前端单页应用（SPA），无独立后端。

## 2. 技术要求

- **框架**：Vite + React + TypeScript
- **UI**：shadcn/ui（基于 Radix），卡片式设计
- **样式**：以组件样式为主（允许少量全局样式变量/utility 以支持主题/玻璃效果）
- **响应式**：移动端与桌面端
- **无后端数据库**

## 3. 主题与外观

- **主题模式**：`light` / `dark` / `system`（跟随系统）。
- **系统主题监听**：在 `system` 模式下监听 `prefers-color-scheme` 并自动切换。
- **持久化**：`localStorage` 记忆主题选择。
- **主题切换控件**：右上角工具条提供 🌞/🌓/🌚 切换（Dropdown 或三段切换）。
- **Emoji**：允许在 UI 标题、徽标与提示中使用 Emoji（需保留可读文字，注意可访问性）。

## 4. 动态背景（新增：粒子背景）

- **目标**：提供轻量的动态粒子背景，增强视觉层次。
- **实现建议**：`react-tsparticles` + `tsparticles-slim`（或等价库），**禁止阻塞主线程**。
- **行为要求**：
  - 背景全屏渲染，`z-index` 低于内容卡片，不拦截页面交互。
  - 颜色随主题切换调整：浅色使用冷色调（蓝），深色使用紫系；在 `system` 模式下 OS 变更时**即时**同步。
  - **尊重减弱动画**：检测并遵循 `prefers-reduced-motion`，提供“关闭动态背景”开关。
  - 性能：60 FPS 目标；空闲 CPU 占用 ≤ 15%（桌面参考），移动端自动降粒子数量。

## 5. 玻璃拟态（Glassmorphism）卡片（新增）

- **范围**：输入卡片与结果卡片采用半透明+模糊的玻璃风格。
- **视觉要点**：
  - 半透明背景（浅色：白 10–15%；深色：Slate 15–20%）。
  - `backdrop-blur` 模糊；细描边（白/黑 10–15% 透明度）；柔和投影。
  - 不影响文本可读性（对比度合规）。
- **兼容性**：
  - 导出 PNG 时若 `backdrop-filter` 不被捕获，需自动启用**导出降级方案**（在导出容器临时叠加半透明底色以保持观感一致）。

## 6. 信息架构与布局

- **Desktop**：
  - 左侧 **1/3**：输入卡片（基础信息表单）。
  - 右侧 **2/3**：结果卡片（摘要+日表；未就绪显示 Empty State）。
- **Mobile**：上方输入卡片，下方结果卡片。
- **Empty State（结果卡片）**：
  - 含 Emoji 图标（如 📝）、标题与说明文案；提示需要填写体重、体型、蛋白系数、天数。

## 7. 国际化（新增：i18n）

- **语言**：`zh-CN` / `en`（可扩展）。
- **默认**：首访依据浏览器语言；用户切换后持久化到 `localStorage`。
- **运行时切换**：不刷新页面即可更换语言；导出文本/图片内容跟随语言。
- **覆盖范围**：所有标签、控件提示、按钮、表格标题、日型名称、空态与 footer 免责声明。

## 8. 单位系统切换（新增：kg / lbs）

- **开关**：`Metric (kg)` / `Imperial (lb)`；默认 Metric。
- **内部计算**：统一使用 kg；切换时进行数值换算**不重置**用户输入。
- **显示与校验**：
  - kg 范围：30–200；lb 范围：66–440（四舍五入到 0.1）。
  - UI 同步显示单位；导出内容随所选单位显示。

## 9. 功能需求（营养计算）

### 9.1 用户输入表单

1. 体重（kg/lb）—— 数字输入；必填；范围随单位切换。
2. 体型（RadioGroup）—— 内胚/中胚/外胚；必填。
3. 训练水平/蛋白系数（RadioGroup + 条件输入）—— 初学者 0.8 g/kg；有经验者 1.5 g/kg；自定义 0.8–2.0 g/kg；必填。
4. 循环天数（Slider）—— 3–7，默认 7。

### 9.2 计算逻辑

**营养素系数表**
| 体型 | 碳水 (g/kg) | 脂肪 (g/kg) |
| ------ | ----------- | ----------- |
| 内胚型 | 2.0 | 1.0 |
| 中胚型 | 2.5 | 0.9 |
| 外胚型 | 3.0 | 1.1 |

**循环分配比例**

- 高碳日：周碳水 50%，周脂肪 15%
- 中碳日：周碳水 35%，周脂肪 35%
- 低碳日：周碳水 15%，周脂肪 50%
- 蛋白质：每日固定（体重 × 蛋白质系数）

**天数分配**

- 3 天：1 高 / 1 中 / 1 低
- 4 天：1 高 / 2 中 / 1 低
- 5 天：1 高 / 2 中 / 2 低
- 6 天：2 高 / 2 中 / 2 低
- 7 天：2 高 / 3 中 / 2 低

**计算步骤**

1. 每日基础：碳水=体重×碳水系数；脂肪=体重×脂肪系数；蛋白=体重×蛋白系数。
2. 周总量：每日基础×循环天数（对碳水与脂肪）。
3. 将周总量按比例分配至高/中/低碳日，再在各自天数上**均分**。
4. 每日热量：4×碳水 + 9×脂肪 + 4×蛋白。

## 10. 结果展示与导出

- 周度摘要卡片（🥗 每日本蛋白、🍚 周碳水、🧈 周脂肪、🔥 周热量）。
- 每日明细表：天数、日型、碳水 g、脂肪 g、蛋白 g、总热量 kCal。
- **复制**：一键复制 Markdown 文本（随语言与单位）。
- **导出图片（计划图片生成）**：将结果区域导出为 PNG；若 `backdrop-filter` 无法被捕获，自动应用导出降级方案以保持玻璃观感一致。

## 11. 验证与错误提示

- 表单校验：`react-hook-form` + `zod`；错误信息在控件下方呈现。
- 必填项未完成时仅显示空态，不渲染结果表。
- 数字显示：最终对外显示为整数（四舍五入），内部用浮点计算。

## 12. Footer 免责声明

- 固定在底部：
  - **公式来源**：基于凯圣王碳循环饮食理论。
  - **免责声明**：本工具仅供训练与营养规划参考，不构成医疗建议，不承担任何医疗后果。

## 13. 非功能性要求

- **性能**：
  - 首屏 JS < 120KB（不含字体/图标）；交互响应 < 100ms。
  - 粒子背景 60 FPS 目标；空闲 CPU ≤ 15%。
  - 移动端自动降级粒子数量与连线效果。
- **可访问性**：
  - 键盘可达、焦点可见；对比度达标。
  - `prefers-reduced-motion` 时自动关闭或显著弱化动画。
- **兼容性**：Chrome/Edge/Firefox/Safari 最近两个大版本。

## 14. 验收标准（新增/更新）

- **主题**：
  - 选择 `light/dark` 后刷新保持；`system` 模式下 OS 改变时 UI **即时**切换。
- **粒子背景**：
  - 不阻挡交互；在 `system` 切换与 `prefers-reduced-motion` 下行为符合预期；提供关闭开关。
- **玻璃卡片**：
  - 视觉符合规格；导出 PNG 时观感与在线预览一致（允许微弱差异）。
- **i18n**：
  - 切换语言时所有文案即时更新（含导出/复制内容、空态、footer）。
- **单位切换**：
  - kg↔lb 切换后数值正确互换；校验与占位单位同步变化。
- **计算正确性**：
  - 各日碳水/脂肪求和≈周碳水/周脂肪（±1g 允许）；总周热量≈每日热量之和（±1kCal 允许）。

## 15. 可选增强

- 本地存储最近一次输入（含语言、单位、主题、是否启用粒子背景）。
- 结果表首列/表头粘性（窄屏横向滚动优化）。
- 简易使用指南（Tooltip/Help 卡片）。
